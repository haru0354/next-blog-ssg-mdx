# 概要

「Next.js」と「.mdx」で作成する静的なブログアプリとなります。

「Imageコンポーネント(Next.js)」の変わりに、「sharp」を利用して画像の処理を行いページの軽量化を行っています。
（webp拡張子かつ圧縮した2種類のサイズの画像ファイルを自動生成）

サイト制作者が気になる、SEOも考慮した設計となっています。

- H1の見出しタグをページにより変更
- TOPページにコンテンツの挿入可
- カテゴリページにコンテンツの挿入可
- 画像の軽量化

また、デザインの変更 / カラーの変更 / ブログの設定など、環境変数を利用して簡単に変更が可能です。

誰でも簡単に本格的なブログを構築できるを目指して作成しています。

## 特徴

誰でも簡単にNext.jsのSSGを利用した、静的な本格ブログを構築することが可能です。

- 記事やカテゴリをmdxファイルで管理（載せ替えも簡単）
- SEOを意識したブログを構築
- 複数のデザインパターン
- 環境変数より簡単にデザイン変更
- 画像をwebpに変換し圧縮（ブログの軽量化）
- デザインコンポーネント（記事を簡単に装飾）
- sitemap.xmlは自動で作成

「デザイン」「カラー設定」「ブログの設定（表示記事数など）」など、全て環境変数（.env）を利用して、簡単に変更が可能です。

## 主な技術スタック

- TypeScript
- Next.js v14
- React v18
- Tailwind CSS
- sharp：（画像処理）
- gray-matter（フロントマターの抽出）
- next-mdx-remote（.mdxファイルの読み込みと表示）

## セットアップ手順

1. リポジトリをクローン：

git clone https://github.com/haru0354/next-blog-ssg-mdx.git

cd next-blog-ssg-mdx

2. 依存関係をインストール：

npm install

3. 環境ファイルを用意：

cp .env.example .env

デザインの変更は環境変数の変更で確認できます

4. サーバーを起動：

npm run dev

### コマンドの概要

| コマンド        | 説明                                                 |
| --------------- | ---------------------------------------------------- |
| `npm install`   | フロントエンドの依存関係をインストール               |
| `npm run dev`   | フロントエンドのサーバー起動        |
| `npm run image` | public フォルダの画像の圧縮と拡張子を変更（webp へ） |


## ブログの使い方について

誰でも使えるように、かつ、実用性のあるブログとして作成しています。

- SEO を意識したサイト構造
- 画像を webp に変換し圧縮
- 作成時に変更する箇所
- デザインの変更
- 追加できるメニュー
- 今後追加する項目

### SEO を意識したサイト構造

SEO を気にする人用にデフォルトのサイト構造を紹介します。

- TOP ページ

  - logo が h1 タグとなっています。
  - カテゴリタイトルは h3 タグとなります。
  - 記事タイトルは h3 タグとなります。

- 記事ページ

  - logo は見出しタグは付きません。
  - 記事タイトルが h1 タグとなります。

- カテゴリページ

  - 関連記事は h2 タグとなります。
  - 関連記事内の各個別ページのタイトルは h3 タグとなります。

記事ページのタイトルは「記載した記事タイトル | サイトタイトル」になります。
カテゴリページのタイトルは「記載したカテゴリタイトル | サイトタイトル」になります。

「TOPページ」と「カテゴリページ」は記事ページのように、コンテンツの挿入をすることができるようになっています。

### 画像をwebpに変換し圧縮

publicフォルダに画像を配置すると下記コマンドで圧縮と変換がされた画像が配置されます。

「npm run dev」と[npm run build]の実行時に 2 種類の画像ファイルに圧縮と変換が行われます。
また、「npm run image」コマンドでは画像の圧縮のみがされます。

1. image_webp フォルダ：80%の品質で圧縮、webp に変換
2. thumbnail_webp フォルダ：80%の品質で圧縮、width：300px、webp に変換

記事のアイキャッチには「image_webp フォルダ」の画像が配置されます。
TOP ページ、関連記事、サイドメニューには「thumbnail_webp フォルダ」の画像が配置されます。

変換をした画像は「scripts フォルダ」の「convertedFileNameList.json」にリスト化されていきます。
再度、実行時に照らし合わせて、未変換のファイルのみ変換と圧縮がされるようになっています。

現状、「thumbnail_webp フォルダ」の画像はサイトのテンプレートの中で 280px から 350px の画像が使われています。

詳しくは scripts フォルダにある「convertToWebp.mjs」をご覧ください。


## 作成時に変更する箇所

このブログを利用する際にサイトタイトル等、変更する箇所が数点あります。

- 画像
  - ロゴ画像(logo.png)
  - ファビコン(favicon.ico)
- 環境変数(.env.sample)
- robot.txt(変更箇所)

ロゴ画像(logo.png)やファビコン(favicon.ico)はカッコ内の名称で画像が設置されています。

ロゴ画像はpublic フォルダに画像を配置し、「npm run image」コマンドを実行してください。
webp に圧縮された画像が配置されるようになっています。

ファビコンはappフォルダ内に配置することで変更できます。

基本的にその他の変更箇所は「.env.local」に用意されている下記の環境変数の各項目を変更することで反映がされます。

- サイトURL
- サイトタイトル
- サイト説明文

但し、「robot.txt」に関してはそのままサイトの URL を変更するようにしてださい。

「新規記事の作成方法」や「カテゴリの作成方法」などは詳しい解説を「create-article.mdx」内にて行っています。

mdx-files > article > blog-guide に設置されています。

## デザインの変更

デザインの変更 / 色調の変更 等は環境変数（.env）ファイルより数字などの変更をすることが可能です。

- デザインの変更（各パーツのデザイン変更）
- イメージカラーの変更（配色の変更）
- ブログの設定（各パーツの表示記事数など）

github には「.env.sample」としてアップをいるので、これを「.env」としてコピーして頂ければと思います。

全て変更できる項目においては、コメントとして記載をしています。
また、詳しい解説はmdxファイルに解説を行っています。

- env-design.mdx(デザイン変更)
- blog-design.mdx（記事内の装飾）

mdx-files > article > blog-guide に設置されています。

## 追加できるメニュー

記載をすることで様々なメニューを追加できるようになっています。

- グローバルメニュー(globalMenu.md)
- サイドバーのおすすめの記事(recommendArticle.md)
- サイドバーのリンク(参考文献・参考サイト)(link.md)

それぞれのファイルは mdFile ディレクトリの menu ディレクトリの中にあります。
各ファイルの１つ目を記載すると、各メニューが表示されるようになります。

## 新規追加予定の機能・変更点（個人的メモ）

- TOP ページ用のコンポーネント（おすすめ記事 6 個）を作成(済)
- サイドバーのカテゴリを任意の項目を表示できるようにする（済）
- TOP ページ用のコンポーネント（おすすめ記事 ２カラムの左画像と右テキスト）を作成（済）
- 検索バーの追加（済）
- 検索が 2 語のキーワードでも出来るよう変更（済）
- TOP ページ用のコンポーネント（大カテゴリと子カテゴリを表示させる）を作成
- TOP ページ用のコンポーネント（おすすめ記事 上段大画像 2 個 / 下段小画像 3 個）を作成
- サイドバーの新着記事を子カテゴリページでは親カテゴリの新着記事を表示させる
- デザインコンポーネントの追加
