# 概要

Next.js で SSG でのブログを作成することができます。

- SEO を意識したサイト構造
  - 画像を webp に変換し圧縮
- 作成時に変更する箇所
- カテゴリの作成手順
  - カテゴリの補足
- 記事の作成手順
  - 記事の補足
- 追加できるメニュー
- デザインの変更
- 今後追加する項目

Markdown ファイルへの記述により記事やカテゴリを追加していきます。

デザインは tailwind を使用しています。
コンテンツ部分(MDX ファイルに記載部分)のデザインは「globals.css」に記載し適用がされています。

今後、css は追加予定ですが現状で使用したい人は個別で追加して頂ければと思います。

現状の項目が少ないのでそのまま css を使用しています。
項目を増やすのなら sass を適用するのがネスト化の手間が省けていいかと思います。

## 使用技術

- TypeScript
- React / Next.js 14(SSG)
- Tailwind CSS

その他のライブラリ等の一部

- @next/mdx
- react-markdown
- gray-matter
- rehype-slug
- remark-toc
- sharp

「MDX に対応」「目次の作成」「画像の圧縮」の為に、これらのライブラリなどの導入がされています。

## SEO を意識したサイト構造

SEO を気にする人用にデフォルトのサイト構造を紹介します。

現状、見出しタグは重視されないとされています。
但し、簡単にできることは全て行うのが SEO の基本かと思います。

h1 見出しタグが複数あったり、コンテンツが h2 タグしかなかったりと、サイト構造がしっかりしていないのを見ると、個人的にはすごく気になります。

- TOP ページ

  - logo が h1 タグとなっています。
  - カテゴリタイトルは h3 タグとなります。
  - 記事タイトルは h3 タグとなります。

- 記事ページ

  - logo は見出しタグは付きません。
  - 記事タイトルが h1 タグとなります。

- カテゴリページ
  - 関連記事は h2 タグとなります。
  - 関連記事内の各個別ページのタイトルは h3 タグとなります。

記事ページのタイトルは「記載した記事タイトル | サイトタイトル」になります。
カテゴリページのタイトルは「記載したカテゴリタイトル | サイトタイトル」になります。

TOP ページはサイト名が H1 で各記事ページは記事タイトルが H1 の最近の主流？の構造になっています。

## Next.jsの便利な機能を利用したブログ

このブログではmdxファイルを利用しコンテンツを作成し、SSGでのブログを構築できます。

できるだけNext.Jsの便利な機能を使えるようにしたい為、下記の項目がいかせるようになっています。

- 画像コンポーネント(webpへの変換と圧縮)
- MDXファイル内で画像コンポーネントの仕様
- MDXファイル内でリンクコンポーネントの仕様

詳しくは下記をご覧ください。

### 画像をwebpに変換し圧縮

publicフォルダに画像を配置すると下記コマンドで圧縮と変換がされた画像が配置されます。

「npm run dev」と[npm run build]の実行時に 2 種類の画像ファイルに圧縮と変換が行われます。
また、「npm run image」コマンドでは画像の圧縮のみがされます。

1. image_webp フォルダ：80%の品質で圧縮、webp に変換
2. thumbnail_webp フォルダ：80%の品質で圧縮、width：300px、webp に変換

記事のアイキャッチには「image_webp フォルダ」の画像が配置されます。
TOP ページ、関連記事、サイドメニューには「thumbnail_webp フォルダ」の画像が配置されます。

変換をした画像は「scripts フォルダ」の「convertedFileNameList.json」にリスト化されていきます。
再度、実行時に照らし合わせて、未変換のファイルのみ変換と圧縮がされるようになっています。

現状、「thumbnail_webp フォルダ」の画像はサイトのテンプレートの中で 280px から 350px の画像が使われています。

詳しくは scripts フォルダにある「convertToWebp.mjs」をご覧ください。

### MDXファイル内でNext.jsのリンクコンポーネントの使用が可能

MDXファイル内でもNext.jsのLinkコンポーネントが使用できるようにしています。

下記のように記述することでLinkコンポーネントの使用となります。

<CustomLink href="/test">test</CustomLink>

また、外部サイトへのリンク時には通常の<a>タグが使用できるようになっています。

### MDXファイル内でNext.jsの画像コンポーネントの使用が可能

MDXファイル内でもNext.jsの画像コンポーネントが使用できるようにしています。

下記のように記述することで画像コンポーネントの使用となります。

<CustomImage width={width} height={height} src={src} alt={alt} className={className}>test</CustomImage>

Next.jsの画像コンポーネントをそのまま使用しますので、「width」「height」「src」「alt」の項目は必須となります。

また、classNameには「tailwind.css」での記述となりますが、スタイルの変更をすることも可能です。

## 作成時に変更する箇所

このブログを利用する際にサイトタイトル等、変更する箇所が数点あります。

- 画像
  - ロゴ画像(logo.png)
  - ファビコン(favicon.ico)
- 環境変数(.env.local)
- robot.txt(変更箇所)

ロゴ画像(logo.png)やファビコン(favicon.ico)はカッコ内の名称で画像が設置されています。

ロゴ画像はpublic フォルダに画像を配置し、「npm run image」コマンドを実行してください。
webp に圧縮された画像が配置されるようになっています。

ファビコンはappフォルダ内に配置することで変更できます。

基本的にその他の変更箇所は「.env.local」に用意されている下記の環境変数の各項目を変更することで反映がされます。

- サイトURL
- サイトタイトル
- サイト説明文

但し、「robot.txt」に関してはそのままサイトの URL を変更するようにしてださい。

## TOP ページをコンテンツページにする

初期状態では TOP ページは、1 カラムの新着記事やカテゴリなどを表示するデザインとなっています。

この TOP ページをブログの個別ページと同様に、2 カラムのコンテンツとサイドバーの表示に切り替えをすることができます。

### TOP ページをコンテンツページにする方法

TOP ページ用のファイルにコンテンツを記載することによって、コンテンツページにすることができます。

mdFile > topPage > topPageArticle.mdx

上記のファイルにコンテンツを記載し、上部の「contentPage」の項目を「true」と記載することにより、コンテンツページに変更をすることができます。

元に戻す時は先ほど変更をした「true」を「false」にすることで可能です。

## カテゴリの作成手順

現状でこのブログは最大で３階層までとなっており、「親カテゴリ」と「子カテゴリ」の２種類が作成可能となっています。

TOP ページ
|_ 親カテゴリ
　 |_ 子カテゴリ
　　 |\_ 記事ページ

TOP ページ
|_ 親カテゴリ
　　 |_ 記事ページ

### 親カテゴリの作成手順

1. mdFile ディレクトリの「categorySample」をコピー
2. 「mdFile > category」ディレクトリとへコピーしたサンプルファイルを入れる。
3. ファイル名を変更する(slug になる)。
4. 各項目を変更をする。
5. 「mdFile > article」ディレクトリにカテゴリのファイル名でフォルダを作成する

article ディレクトに作成したフォルダ内に個別記事を入れることで、その記事はカテゴリに属することになります。

### 子カテゴリの作成手順

1. mdFile ディレクトリの「categorySample」をコピー
2. mdFile > category ディレクトリに親カテゴリの.mdx を省いた名称でフォルダを作成
3. 作成したディレクトリにコピーしたサンプルファイルを入れる。
4. ファイル名を変更する(slug になる)。
5. 各項目を変更をする。
6. 「mdFile > article」ディレクトリの親カテゴリフォルダ内に.mdx を省いた子カテゴリの名称でフォルダを作成

article ディレクトに作成したフォルダ内に個別記事を入れることで、その記事はカテゴリに属することになります。

### カテゴリの補足

カテゴリページは初期状態で「リスト表示」となり、コンテンツを記載すればコンテンツの表示もされるように作成しています。。

上記仕様の理由としてはユーザービリティーと SEO を考慮しています。

サイト構造を考えても上記仕様が適していると思います。

SEO 的には簡単に説明するとカテゴリページは内部リンクが集まりやすく、サイト構造の部分も含めてページを作りこむのに適しているからです。

categoryName: カテゴリ名を記載
title: カテゴリのタイトル(記事タイトルと同じ)

## 記事の作成手順

1. mdFile ディレクトリの「articleSample」をコピー
2. mdFile > article ディレクトリの記事を含めたいカテゴリフォルダ内にコピーしたサンプルファイルを入れる。
3. ファイル名を変更する(slug になる)。
4. 各項目を変更をする。

### 固定記事(どのカテゴリにも属さない)の作成方法

どのカテゴリにも属さない固定記事に関しては、「mdFile > article」ディレクトリ内に「articleSample」ファイルを入れてください。

この固定記事は「TOP ページ ＞　固定ページ」となります。

まだ、どのカテゴリにも属さず、新着記事の項目などにも表示がされないようになっています。

主に、「WEB サイトの運営全般の内容」や「CTA 目的とした記事」や「どのカテゴリにも属さない記事」などを想定しています。

## 追加できるメニュー

記載をすることで様々なメニューを追加できるようになっています。

- グローバルメニュー(globalMenu.md)
- サイドバーのおすすめの記事(recommendArticle.md)
- サイドバーのリンク(参考文献・参考サイト)(link.md)

それぞれのファイルは mdFile ディレクトリの menu ディレクトリの中にあります。
各ファイルの１つ目を記載すると、各メニューが表示されるようになります。

## デザインの変更

- パターン 2 への変更(ブロック型)

  - SideMenu.tsx の「bg-white」を外す
  - コンポーネント > sideMenu 内のコンポーネントを SideCategory2 と SideNewArticle2 に変更。
  - (blog) > [category_slug]の１つ目の div タグに「border border-gray-200」を追加
  - (blog) > [category_slug] > [article_slug]の１つ目の div タグに「border border-gray-200」を追加

- カテゴリの関連記事の変更
  - (blog) > [category_slug] 最下部の(CategoryInArticlesList)コンポーネントを変更

1. 画像 2 枚が横並び(CategoryInArticlesList2Images)
2. 左に画像、右にタイトルと説明文(CategoryInArticlesList)

(blog) > [category_slug]

### イメージカラーの変更

tailwind.configにてカラーを設定することで、一括でイメージカラーの変更をすることができます。

イメージカラーで変更がされるのは下記の項目です。

- グローバルメニューの背景色
- フッターの背景色
- コンテンツエリア・サイドメニューの見出し
- コンテンツエリア（デザインコンポーネント）のBOXの背景色

「tailwind.config.ts」ファイルの「theme」「colorsのlayout」の 「mainColor」 の項目を設定したい色のカラーコードで記述します。

初期状態は gray が当たっています。

「colorsのmain」部分には私がイメージカラーとしたカラーコードが記述してあるので、そのままコピー貼り付けでも色を変更することができます。

### 背景色の変更

tailwind.configにてカラーを設定することで、一括で背景色の変更をすることができます。

背景色で変更がされるのは下記の項目です。

- ヘッダーの背景色
- main部分の背景色

ライトカラムとレフトカラムの各項目部分は白色となっており変更されません。
トップページのコンテンツの記載がないデザインタイプも背景色が変更されません。

「tailwind.config.ts」ファイルの「theme」「colorsのlayout」の 「bgColor」 の項目に設定したい色のカラーコードで記述します。

初期状態は白色になっています。

## 個人的メモ

- TOP ページ用のコンポーネント（おすすめ記事 6 個）を作成(済)
- サイドバーのカテゴリを任意の項目を表示できるようにする（済）
- TOP ページ用のコンポーネント（おすすめ記事 ２カラムの左画像と右テキスト）を作成（済）
- 検索バーの追加（済）
- 検索が 2 語のキーワードでも出来るよう変更（済）
- TOP ページ用のコンポーネント（大カテゴリと子カテゴリを表示させる）を作成
- TOP ページ用のコンポーネント（おすすめ記事 上段大画像 2 個 / 下段小画像 3 個）を作成
- サイドバーの新着記事を子カテゴリページでは親カテゴリの新着記事を表示させる
- デザインコンポーネントの追加
